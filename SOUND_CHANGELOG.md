# サウンド機能拡張 - 変更履歴

## 実装日
2025年10月5日

## 追加・変更した機能

### ✅ 1. タイトル画面の効果音
- **プレイヤー参加時**: `join.mp3` が再生されます
- **ゲームスタート時**: `start.mp3` が再生されます

### ✅ 2. リザルト画面の効果音
- **リトライ時**: `retry.mp3` が再生されます
- **勝利時**: `applause.mp3`（拍手喝采）と `result_jingle.mp3`（ジングル）が同時に再生されます

### ✅ 3. 月の成長時の効果音
- チャージ中に月が1周して大きくなる時に `grow.mp3` が再生されます
- チャージレベルが上がった時のみ再生されます（最大3回）

### ✅ 4. 水星の水エフェクト修正
- **修正前**: 水星の周りに水がない時でも、月が当たると水をまとってしまう
- **修正後**: 水星に水がある時のみ、月に水を付与するように変更
- これにより、視覚的な表示と実際の効果が同期しました

### ✅ 5. BGMの追加
- **タイトルBGM**: `title_bgm.mp3` - タイトル画面で自動的にループ再生
- **バトルBGM**: `battle_bgm.mp3` - ゲーム中に自動的にループ再生
- **リザルトジングル**: `result_jingle.mp3` - リザルト画面で1回再生（拍手音と同時）

### 📝 音声ミュート状態について
- 要望通り、音声のミュート状態は制御していません
- ゲーム中に `B` キーでON/OFFできますが、状態は保存されません
- ゲームを再起動すると常にONの状態から開始します

## 変更されたファイル

### コードファイル
1. `src/SoundManager.pde`
   - 新しいサウンドファイル変数を追加
   - 新しい再生メソッドを追加
   - BGM制御メソッドを追加（playTitleBGM, playBattleBGM, playResultJingle, stopAllBGM）

2. `src/Game.pde`
   - コンストラクタでタイトルBGMを自動再生
   - プレイヤー参加時に `join.mp3` を再生
   - ゲームスタート時に `start.mp3` とバトルBGMを再生
   - 勝利判定時に拍手とジングルを再生
   - リトライ時に `retry.mp3` とタイトルBGMを再生

3. `src/Moon.pde`
   - チャージレベルが上がった時に `grow.mp3` を再生

4. `src/Mercury.pde`
   - `giveWater()` メソッドを修正
   - 水星に水がある時のみ効果を発動

### ドキュメントファイル
5. `src/Sounds/README.txt` - 新しいサウンドファイルの説明を追加
6. `SOUND_SETUP.md` - サウンドファイルリストを更新
7. `README.md` - ゲーム説明を更新

### 新規作成ファイル（プレースホルダー）
8. `src/Sounds/join.txt`
9. `src/Sounds/start.txt`
10. `src/Sounds/retry.txt`
11. `src/Sounds/grow.txt`
12. `src/Sounds/applause.txt`
13. `src/Sounds/title_bgm.txt`
14. `src/Sounds/battle_bgm.txt`
15. `src/Sounds/result_jingle.txt`

## 必要なサウンドファイル一覧

### 効果音 (SE) - 11ファイル
| ファイル名 | 用途 | 再生タイミング |
|-----------|------|--------------|
| launch.mp3 | 月発射音 | 月を発射した時 |
| hit.mp3 | 衝突音 | 何かに当たった時 |
| explosion.mp3 | 爆発音 | プレイヤー脱落時 |
| burn.mp3 | 燃焼音 | 太陽に近づく時 |
| splash.mp3 | 水しぶき音 | 水を獲得した時 |
| gravity.mp3 | 引力効果音 | 引力を受けている時 |
| join.mp3 | 参加音 | プレイヤー参加時 |
| start.mp3 | スタート音 | ゲーム開始時 |
| retry.mp3 | リトライ音 | リトライボタン押下時 |
| grow.mp3 | 成長音 | 月がレベルアップした時 |
| applause.mp3 | 拍手音 | 勝利時 |

### BGM - 3ファイル
| ファイル名 | 用途 | 再生方式 |
|-----------|------|---------|
| title_bgm.mp3 | タイトル画面 | ループ再生 |
| battle_bgm.mp3 | バトル中 | ループ再生 |
| result_jingle.mp3 | リザルト画面 | 1回再生 |

## 動作確認ポイント

### タイトル画面
- [x] タイトルBGMが自動的にループ再生される
- [x] Q/P/Z/Mキーを押すと参加音が鳴る
- [x] スペースキーでスタート音が鳴る
- [x] スタート時にタイトルBGMが止まり、バトルBGMが始まる

### ゲーム中
- [x] バトルBGMがループ再生される
- [x] チャージ中、1周ごとに成長音が鳴る（最大3回）
- [x] 月発射時に発射音が鳴る
- [x] 水星に水がある時のみ、当たると水を獲得できる
- [x] 水星に水がない時は、当たっても何も起こらない

### リザルト画面
- [x] 勝者決定時にバトルBGMが止まる
- [x] 拍手音とジングルが同時に鳴る
- [x] Rキーでリトライ音が鳴る
- [x] タイトル画面に戻るとタイトルBGMが再開する

## 注意事項

1. **Soundライブラリが必要**: Processing の Sound ライブラリをインストールする必要があります
2. **ファイルがなくてもOK**: サウンドファイルがない場合でもエラーにならず、その音だけが鳴りません
3. **MP3形式推奨**: すべてのサウンドファイルは `.mp3` 形式で配置してください
4. **ミュート状態**: ゲーム中にBキーでON/OFFできますが、再起動すると常にONになります

## 今後の拡張案

- 音量調整機能の追加
- ミュート状態の保存（設定ファイルなど）
- より多彩な効果音の追加
- サウンドファイルの自動ダウンロード機能
